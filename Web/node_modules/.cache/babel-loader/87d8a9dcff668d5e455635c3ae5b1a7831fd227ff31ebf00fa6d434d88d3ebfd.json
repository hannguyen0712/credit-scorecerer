{"ast":null,"code":"import { GoogleGenerativeAI } from '@google/generative-ai';\nclass GeminiService {\n  constructor() {\n    this.genAI = void 0;\n    const apiKey = process.env.REACT_APP_GEMINI_API_KEY;\n    if (!apiKey) {\n      throw new Error('REACT_APP_GEMINI_API_KEY is not set in environment variables');\n    }\n    this.genAI = new GoogleGenerativeAI(apiKey);\n  }\n  async getPurchaseRecommendation(request, userCards) {\n    try {\n      const model = this.genAI.getGenerativeModel({\n        model: 'gemini-pro'\n      });\n      const prompt = this.buildConsultationPrompt(request, userCards);\n      const result = await model.generateContent(prompt);\n      const response = await result.response;\n      const text = response.text();\n      return this.parseAIResponse(text, userCards);\n    } catch (error) {\n      console.error('Error getting AI recommendation:', error);\n      throw new Error('Failed to get AI recommendation. Please try again.');\n    }\n  }\n  buildConsultationPrompt(request, userCards) {\n    const cardsInfo = userCards.map(card => `Card: ${card.name} (${card.issuer})\n       - Credit Limit: $${card.creditLimit.toLocaleString()}\n       - Current Balance: $${card.currentBalance.toLocaleString()}\n       - Available Credit: $${card.availableCredit.toLocaleString()}\n       - Interest Rate: ${card.interestRate}%\n       - Rewards: ${card.rewards.type} at ${card.rewards.rate}% rate\n       - Utilization: ${(card.currentBalance / card.creditLimit * 100).toFixed(1)}%`).join('\\n\\n');\n    return `You are a financial advisor helping with credit card purchase decisions. \n\nUser's Credit Cards:\n${cardsInfo}\n\nPurchase Details:\n- Amount: $${request.purchaseAmount}\n- Category: ${request.purchaseCategory}\n- Description: ${request.description}\n${request.preferredCard ? `- Preferred Card: ${request.preferredCard}` : ''}\n\nPlease provide a recommendation in the following JSON format:\n{\n  \"recommendation\": {\n    \"recommendedCard\": \"Card name\",\n    \"reasoning\": \"Detailed explanation of why this card is best\",\n    \"creditImpact\": \"positive|neutral|negative\",\n    \"impactExplanation\": \"How this purchase affects credit score\"\n  },\n  \"alternatives\": [\n    {\n      \"cardId\": \"card-id\",\n      \"cardName\": \"Card name\",\n      \"pros\": [\"advantage 1\", \"advantage 2\"],\n      \"cons\": [\"disadvantage 1\", \"disadvantage 2\"]\n    }\n  ],\n  \"tips\": [\n    \"Tip 1 for optimizing this purchase\",\n    \"Tip 2 for credit management\"\n  ]\n}\n\nConsider:\n1. Credit utilization impact\n2. Rewards optimization\n3. Interest rates if balance will be carried\n4. Credit score implications\n5. Payment due dates and cash flow\n\nProvide practical, actionable advice.`;\n  }\n  parseAIResponse(responseText, userCards) {\n    try {\n      var _parsed$recommendatio, _parsed$recommendatio2, _parsed$recommendatio3, _parsed$recommendatio4, _parsed$alternatives;\n      // Extract JSON from the response\n      const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        throw new Error('No JSON found in response');\n      }\n      const parsed = JSON.parse(jsonMatch[0]);\n\n      // Validate and map the response\n      return {\n        recommendation: {\n          recommendedCard: ((_parsed$recommendatio = parsed.recommendation) === null || _parsed$recommendatio === void 0 ? void 0 : _parsed$recommendatio.recommendedCard) || 'Unknown',\n          reasoning: ((_parsed$recommendatio2 = parsed.recommendation) === null || _parsed$recommendatio2 === void 0 ? void 0 : _parsed$recommendatio2.reasoning) || 'No reasoning provided',\n          creditImpact: ((_parsed$recommendatio3 = parsed.recommendation) === null || _parsed$recommendatio3 === void 0 ? void 0 : _parsed$recommendatio3.creditImpact) || 'neutral',\n          impactExplanation: ((_parsed$recommendatio4 = parsed.recommendation) === null || _parsed$recommendatio4 === void 0 ? void 0 : _parsed$recommendatio4.impactExplanation) || 'No impact explanation'\n        },\n        alternatives: ((_parsed$alternatives = parsed.alternatives) === null || _parsed$alternatives === void 0 ? void 0 : _parsed$alternatives.map(alt => ({\n          cardId: alt.cardId || '',\n          cardName: alt.cardName || 'Unknown Card',\n          pros: alt.pros || [],\n          cons: alt.cons || []\n        }))) || [],\n        tips: parsed.tips || []\n      };\n    } catch (error) {\n      var _userCards$;\n      console.error('Error parsing AI response:', error);\n      // Return a fallback response\n      return {\n        recommendation: {\n          recommendedCard: ((_userCards$ = userCards[0]) === null || _userCards$ === void 0 ? void 0 : _userCards$.name) || 'Unknown',\n          reasoning: 'Unable to parse AI response. Please try again.',\n          creditImpact: 'neutral',\n          impactExplanation: 'Unable to determine impact.'\n        },\n        alternatives: [],\n        tips: ['Consider your credit utilization when making purchases.', 'Pay off balances in full when possible.']\n      };\n    }\n  }\n  async getGeneralCreditAdvice(question, userCards) {\n    try {\n      const model = this.genAI.getGenerativeModel({\n        model: 'gemini-pro'\n      });\n      const cardsInfo = userCards.map(card => `${card.name}: $${card.currentBalance}/${card.creditLimit} (${(card.currentBalance / card.creditLimit * 100).toFixed(1)}% utilization)`).join(', ');\n      const prompt = `You are a financial advisor. The user has these credit cards: ${cardsInfo}\n\nUser question: ${question}\n\nProvide helpful, actionable advice about credit management, spending optimization, and credit score improvement. Keep your response concise and practical.`;\n      const result = await model.generateContent(prompt);\n      const response = await result.response;\n      return response.text();\n    } catch (error) {\n      console.error('Error getting general advice:', error);\n      return 'I apologize, but I encountered an error while processing your question. Please try again.';\n    }\n  }\n}\nexport default new GeminiService();","map":{"version":3,"names":["GoogleGenerativeAI","GeminiService","constructor","genAI","apiKey","process","env","REACT_APP_GEMINI_API_KEY","Error","getPurchaseRecommendation","request","userCards","model","getGenerativeModel","prompt","buildConsultationPrompt","result","generateContent","response","text","parseAIResponse","error","console","cardsInfo","map","card","name","issuer","creditLimit","toLocaleString","currentBalance","availableCredit","interestRate","rewards","type","rate","toFixed","join","purchaseAmount","purchaseCategory","description","preferredCard","responseText","_parsed$recommendatio","_parsed$recommendatio2","_parsed$recommendatio3","_parsed$recommendatio4","_parsed$alternatives","jsonMatch","match","parsed","JSON","parse","recommendation","recommendedCard","reasoning","creditImpact","impactExplanation","alternatives","alt","cardId","cardName","pros","cons","tips","_userCards$","getGeneralCreditAdvice","question"],"sources":["/Users/hanngn/Documents/CreditScorecerer/credit-scorecerer/Web/src/services/GeminiService.ts"],"sourcesContent":["import { GoogleGenerativeAI } from '@google/generative-ai';\nimport { CreditCard, AIConsultationRequest, AIConsultationResponse } from '../types';\n\nclass GeminiService {\n  private genAI: GoogleGenerativeAI;\n\n  constructor() {\n    const apiKey = process.env.REACT_APP_GEMINI_API_KEY;\n    if (!apiKey) {\n      throw new Error('REACT_APP_GEMINI_API_KEY is not set in environment variables');\n    }\n    this.genAI = new GoogleGenerativeAI(apiKey);\n  }\n\n  async getPurchaseRecommendation(\n    request: AIConsultationRequest,\n    userCards: CreditCard[]\n  ): Promise<AIConsultationResponse> {\n    try {\n      const model = this.genAI.getGenerativeModel({ model: 'gemini-pro' });\n\n      const prompt = this.buildConsultationPrompt(request, userCards);\n      const result = await model.generateContent(prompt);\n      const response = await result.response;\n      const text = response.text();\n\n      return this.parseAIResponse(text, userCards);\n    } catch (error) {\n      console.error('Error getting AI recommendation:', error);\n      throw new Error('Failed to get AI recommendation. Please try again.');\n    }\n  }\n\n  private buildConsultationPrompt(request: AIConsultationRequest, userCards: CreditCard[]): string {\n    const cardsInfo = userCards.map(card => \n      `Card: ${card.name} (${card.issuer})\n       - Credit Limit: $${card.creditLimit.toLocaleString()}\n       - Current Balance: $${card.currentBalance.toLocaleString()}\n       - Available Credit: $${card.availableCredit.toLocaleString()}\n       - Interest Rate: ${card.interestRate}%\n       - Rewards: ${card.rewards.type} at ${card.rewards.rate}% rate\n       - Utilization: ${((card.currentBalance / card.creditLimit) * 100).toFixed(1)}%`\n    ).join('\\n\\n');\n\n    return `You are a financial advisor helping with credit card purchase decisions. \n\nUser's Credit Cards:\n${cardsInfo}\n\nPurchase Details:\n- Amount: $${request.purchaseAmount}\n- Category: ${request.purchaseCategory}\n- Description: ${request.description}\n${request.preferredCard ? `- Preferred Card: ${request.preferredCard}` : ''}\n\nPlease provide a recommendation in the following JSON format:\n{\n  \"recommendation\": {\n    \"recommendedCard\": \"Card name\",\n    \"reasoning\": \"Detailed explanation of why this card is best\",\n    \"creditImpact\": \"positive|neutral|negative\",\n    \"impactExplanation\": \"How this purchase affects credit score\"\n  },\n  \"alternatives\": [\n    {\n      \"cardId\": \"card-id\",\n      \"cardName\": \"Card name\",\n      \"pros\": [\"advantage 1\", \"advantage 2\"],\n      \"cons\": [\"disadvantage 1\", \"disadvantage 2\"]\n    }\n  ],\n  \"tips\": [\n    \"Tip 1 for optimizing this purchase\",\n    \"Tip 2 for credit management\"\n  ]\n}\n\nConsider:\n1. Credit utilization impact\n2. Rewards optimization\n3. Interest rates if balance will be carried\n4. Credit score implications\n5. Payment due dates and cash flow\n\nProvide practical, actionable advice.`;\n  }\n\n  private parseAIResponse(responseText: string, userCards: CreditCard[]): AIConsultationResponse {\n    try {\n      // Extract JSON from the response\n      const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        throw new Error('No JSON found in response');\n      }\n\n      const parsed = JSON.parse(jsonMatch[0]);\n      \n      // Validate and map the response\n      return {\n        recommendation: {\n          recommendedCard: parsed.recommendation?.recommendedCard || 'Unknown',\n          reasoning: parsed.recommendation?.reasoning || 'No reasoning provided',\n          creditImpact: parsed.recommendation?.creditImpact || 'neutral',\n          impactExplanation: parsed.recommendation?.impactExplanation || 'No impact explanation'\n        },\n        alternatives: parsed.alternatives?.map((alt: any) => ({\n          cardId: alt.cardId || '',\n          cardName: alt.cardName || 'Unknown Card',\n          pros: alt.pros || [],\n          cons: alt.cons || []\n        })) || [],\n        tips: parsed.tips || []\n      };\n    } catch (error) {\n      console.error('Error parsing AI response:', error);\n      // Return a fallback response\n      return {\n        recommendation: {\n          recommendedCard: userCards[0]?.name || 'Unknown',\n          reasoning: 'Unable to parse AI response. Please try again.',\n          creditImpact: 'neutral',\n          impactExplanation: 'Unable to determine impact.'\n        },\n        alternatives: [],\n        tips: ['Consider your credit utilization when making purchases.', 'Pay off balances in full when possible.']\n      };\n    }\n  }\n\n  async getGeneralCreditAdvice(question: string, userCards: CreditCard[]): Promise<string> {\n    try {\n      const model = this.genAI.getGenerativeModel({ model: 'gemini-pro' });\n\n      const cardsInfo = userCards.map(card => \n        `${card.name}: $${card.currentBalance}/${card.creditLimit} (${((card.currentBalance / card.creditLimit) * 100).toFixed(1)}% utilization)`\n      ).join(', ');\n\n      const prompt = `You are a financial advisor. The user has these credit cards: ${cardsInfo}\n\nUser question: ${question}\n\nProvide helpful, actionable advice about credit management, spending optimization, and credit score improvement. Keep your response concise and practical.`;\n\n      const result = await model.generateContent(prompt);\n      const response = await result.response;\n      return response.text();\n    } catch (error) {\n      console.error('Error getting general advice:', error);\n      return 'I apologize, but I encountered an error while processing your question. Please try again.';\n    }\n  }\n}\n\nexport default new GeminiService();\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}